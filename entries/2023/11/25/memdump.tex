% mainfile: ../../../../master.tex
\subsection{Android Memory Dump}
\label{task:20231125_memdump}

\subsubsection{Heap Dump}

\begin{lstlisting}
adb shell am dumpheap <PID> <HEAP-DUMP-FILE-PATH>  
adb shell cat <HEAP-DUMP-FILE-PATH> > <LOCAL-FILE-PATH>
strings <LOCAL-FILE-PATH> <LOCAL-FILE-PATH-FOR-STRINGS>

pip install objection
frida-ps -Uai
# objection -g de.drmaxnix.birthdaycountdown explore
objection -g bloodpressure.bpdiary explore

android hooking list classes #List all loaded classes, As the target application gets usedmore, this command will return more classes.

android hooking search classes bloodpressure.bpdiary
android hooking search methods bloodpressure.bpdiary recordDbActivity

android hooking watch class bloodpressure.bpdiary.recordDbActivity --dump-args --dump-return

android hooking watch class_method bloodpressure.bpdiary.recordDbActivity.showWeight --dump-args --dump-backtrace --dump-return
\end{lstlisting}



% \begin{lstlisting}
% wget https://www.python.org/ftp/python/2.7.9/Python-2.7.9.tgz
% sudo tar xzf Python-2.7.9.tgz
% cd Python-2.7.9
% sudo ./configure --enable-optimizations
% sudo make altinstall
% python2.7 -V
% sudo ln -sfn '/usr/local/bin/python2.7' '/usr/bin/python2'
% sudo update-alternatives --install /usr/bin/python python /usr/bin/python2 1  
% \end{lstlisting}

% Set up emulator environment by appending the following inside \path{~/.bashrc}:
% \begin{lstlisting}[language=bash]
% export ANDROID_SDK_ROOT=~/Android/Sdk
% export ANDROID_HOME=~/Android/Sdk
% export ANDROID_AVD_HOME=~/.android/avd

% PATH=$PATH:$ANDROID_SDK_ROOT/emulator
% \end{lstlisting}

% Register the path: 
% \begin{lstlisting}[language=bash]
% source ~/.bashrc
% \end{lstlisting}

% Create new AVD, Pixel 7 Pro with Tramisu (Android 13 with Google APIs, not Google Play), via Android Studio.

% Run emulator using command: 
% \begin{lstlisting}[language=bash]
% emulator -avd Pixel_7_Pro_API_33
% \end{lstlisting}

% Load APK into emulator: 
% \begin{lstlisting}[language=bash]
% adb devices # to get id of running instance
% adb root
% adb install -r de.drmaxnix.birthdaycountdown.apk
% \end{lstlisting}

% Clone Fridump\footnote{\url{https://pentestcorner.com/introduction-to-fridump}}:
% \begin{lstlisting}[language=bash]
% git clone https://github.com/Nightbringer21/fridump
% code fridump
% pip install frida frida-tools

% \end{lstlisting}

% Download and Run Fridump dependencies:
% \begin{lstlisting}[language=bash]
% git clone https://github.com/Nightbringer21/fridump
% code fridump
% adb push frida-server /data/local/tmp
% sudo sysctl kernel.yama.ptrace_scope=0 && frida-ps -D emulator-5554
% frida-ps -D emulator-5554 | grep Birth # to get process ID of the Birthday app

% # inside emulator shell
% ./data/local/tmp/frida-server
% \end{lstlisting}

% Found out that Fridump doesn't support the latest Android 13 and API 34, so download Android 10 with API 29 with Pixel 3a.

% Run Fridump:
% \begin{lstlisting}[language=bash]
% python fridump.py -U -s Birthday\ Countdown
% \end{lstlisting}
% and it works now!



